
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Lecture%207/">
      
      
        <link rel="next" href="../Lecture%209/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../feed_rss_updated.xml">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Lecture 8 - obsidian-mkdocs template</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#caches" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="obsidian-mkdocs template" class="md-header__button md-logo" aria-label="obsidian-mkdocs template" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            obsidian-mkdocs template
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lecture 8
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="obsidian-mkdocs template" class="md-nav__button md-logo" aria-label="obsidian-mkdocs template" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    obsidian-mkdocs template
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Abdul's Notes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ECS%20158%20-%20Programming%20on%20Parallel%20Architectures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ECS 158   Programming on Parallel Architectures
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../GPU/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GPU
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Lecture%201/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 1
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Lecture%2012/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Latency, Throughput, Dependencies, etc...
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Lecture%202/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 2
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Lecture%203/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 3
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Lecture%204/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 4
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Lecture%205/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Channels in Go
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Lecture%206/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 6
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Lecture%207/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 7
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Lecture 8
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Lecture 8
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#caches" class="md-nav__link">
    <span class="md-ellipsis">
      Caches ($)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caches-locality-temporal-vs-spatial" class="md-nav__link">
    <span class="md-ellipsis">
      Caches &amp; Locality (Temporal vs. Spatial)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cache-miss-types" class="md-nav__link">
    <span class="md-ellipsis">
      Cache Miss Types
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array-strides" class="md-nav__link">
    <span class="md-ellipsis">
      Array Strides
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Array Strides">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-the-stride-length-is-1" class="md-nav__link">
    <span class="md-ellipsis">
      When the stride length is 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-the-stride-length-is-2" class="md-nav__link">
    <span class="md-ellipsis">
      When the stride length is 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stride-length-of-4-not-good" class="md-nav__link">
    <span class="md-ellipsis">
      Stride length of 4, not good!
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matrix-multiply" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Multiply
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Matrix Multiply">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cache-blocking" class="md-nav__link">
    <span class="md-ellipsis">
      Cache Blocking
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loop-un-rolling" class="md-nav__link">
    <span class="md-ellipsis">
      Loop Un-rolling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Loop Un-rolling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chip-multicore-multiprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      (Chip) Multicore Multiprocessor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiprocessor-caches" class="md-nav__link">
    <span class="md-ellipsis">
      Multiprocessor Caches:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-the-goal-of-cache-coherence" class="md-nav__link">
    <span class="md-ellipsis">
      What is the goal of cache coherence?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      More enhancements:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Lecture%209/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture 9
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cache%20thrashing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cache thrashing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../interrupt%20handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Interrupt handler
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../poisoned/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Poisoned
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../queue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Queue
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18" >
        
          
          <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#caches" class="md-nav__link">
    <span class="md-ellipsis">
      Caches ($)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caches-locality-temporal-vs-spatial" class="md-nav__link">
    <span class="md-ellipsis">
      Caches &amp; Locality (Temporal vs. Spatial)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cache-miss-types" class="md-nav__link">
    <span class="md-ellipsis">
      Cache Miss Types
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array-strides" class="md-nav__link">
    <span class="md-ellipsis">
      Array Strides
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Array Strides">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-the-stride-length-is-1" class="md-nav__link">
    <span class="md-ellipsis">
      When the stride length is 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-the-stride-length-is-2" class="md-nav__link">
    <span class="md-ellipsis">
      When the stride length is 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stride-length-of-4-not-good" class="md-nav__link">
    <span class="md-ellipsis">
      Stride length of 4, not good!
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matrix-multiply" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Multiply
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Matrix Multiply">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cache-blocking" class="md-nav__link">
    <span class="md-ellipsis">
      Cache Blocking
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loop-un-rolling" class="md-nav__link">
    <span class="md-ellipsis">
      Loop Un-rolling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Loop Un-rolling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chip-multicore-multiprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      (Chip) Multicore Multiprocessor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiprocessor-caches" class="md-nav__link">
    <span class="md-ellipsis">
      Multiprocessor Caches:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-the-goal-of-cache-coherence" class="md-nav__link">
    <span class="md-ellipsis">
      What is the goal of cache coherence?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      More enhancements:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Lecture 8</h1>

<h3 id="caches">Caches ($)<a class="headerlink" href="#caches" title="Permanent link">&para;</a></h3>
<p>Computer caches are <em>critical</em> for modern performance. This is because accessing main memory can take hundreds of instructions worth of time.  Our computers have relatively small caches, they are just small memories that shadow a larger part of bigger memory. (i.e, RAM)</p>
<p>Caches are usually arranged into blocks. (64B or 128B). Memory transfers usually take place around these block sizes.
Caches are critical for maintaining performance. </p>
<h3 id="caches-locality-temporal-vs-spatial">Caches &amp; Locality (Temporal vs. Spatial)<a class="headerlink" href="#caches-locality-temporal-vs-spatial" title="Permanent link">&para;</a></h3>
<p>Temporal Locality: If you use data at location X now, you will likely use it 
Spatial Locality: If you use data at location X now, you will likely use it at X + 1 soon.</p>
<p>The goal is to take advantage of both temporal and spatial locality. If it is able to, it's a hit, if not, it's a miss.</p>
<h3 id="cache-miss-types">Cache Miss Types<a class="headerlink" href="#cache-miss-types" title="Permanent link">&para;</a></h3>
<p><strong>Compulsory:</strong> This first type of cache miss must occur because the data has not been accessed ever before yet.
A compulsory miss can be reduced by pre-fetching data.</p>
<p><strong>Capacity:</strong> The cache miss occurs because the data was evicted because there was too much stuff in the cache</p>
<p><strong>Conflict:</strong> The cache miss occurred because the data was evicted because there was sharing in the cache: Some other data needed to be put in the same place. </p>
<p>We cannot avoid compulsory misses completely. We can minimize them though by prefetching data of course, so that we do not have to go to main memory as often. </p>
<p>Conflict misses are pretty rare.
- This rarely happens because most modern processors have very highly associative caches: 
- 16 way is quite common meaning that you would have 17 different pieces of data mapping the same location
- <img alt="Screenshot 2025-05-03 at 4.46.47 PM.png" src="../screenshots/Screenshot%202025-05-03%20at%204.46.47%20PM.png" /></p>
<p>Capacity misses are the biggest problem, what we need to do is work on smaller pieces of data. </p>
<p>A really important fact of optimization is that the sequential part of our program runs really fast / efficiently. Otherwise, there really isn't a point.</p>
<h2 id="array-strides">Array Strides<a class="headerlink" href="#array-strides" title="Permanent link">&para;</a></h2>
<p><strong><em>Key things to know:</em></strong>
<em>sizeof(int) = 4 bytes</em>
<em>array size = 32 elements</em>
<em>Fully assoc. cache</em>
<em>line size = 16 bytes</em>
<em>number of lines = 16</em></p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">sum_array</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">my_array</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">stride</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">+=</span><span class="w"> </span><span class="n">stride</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">my_array</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Let's look at two cases, when the stride is value of 1, and when the stride is  a value of 2.</p>
<h4 id="when-the-stride-length-is-1">When the stride length is 1<a class="headerlink" href="#when-the-stride-length-is-1" title="Permanent link">&para;</a></h4>
<p>Initially, you have a <em>compulsory miss</em>, after the compulsory miss, you then, will bring in (pre-fetch) data from main memory. Filling it up all the way to your line size (16 bytes). After doing so, you will keep getting cache hits until you reach the end of your line, where, you will have to go to main memory, and grab in data again. Visually, here is what that looks like.</p>
<p>We have a good hit / miss ratio because our stride is just <code>1</code>. So we are always looking at adjacent elements. </p>
<p><img alt="Screenshot 2025-05-03 at 4.56.33 PM.png" src="../screenshots/Screenshot%202025-05-03%20at%204.56.33%20PM.png" /></p>
<p><img alt="Screenshot 2025-05-03 at 4.56.41 PM.png" src="../screenshots/Screenshot%202025-05-03%20at%204.56.41%20PM.png" /></p>
<h3 id="when-the-stride-length-is-2">When the stride length is 2<a class="headerlink" href="#when-the-stride-length-is-2" title="Permanent link">&para;</a></h3>
<p>Now, here is where issues start to arise</p>
<p>Previously, when the stride length was just 1, we were bringing data into our cache line, and we were using it pretty often, (As noted by the number of hits). However, what if I simply wanted to sum our array up based on every other value? (Every 2nd value)</p>
<p>We introduce a new term called <code>'brought in, but unused'</code>, let's take a look</p>
<p><img alt="Screenshot 2025-05-03 at 5.00.10 PM.png" src="../screenshots/Screenshot%202025-05-03%20at%205.00.10%20PM.png" /></p>
<h3 id="stride-length-of-4-not-good">Stride length of 4, not good!<a class="headerlink" href="#stride-length-of-4-not-good" title="Permanent link">&para;</a></h3>
<p><img alt="Screenshot 2025-05-03 at 5.00.25 PM.png" src="../screenshots/Screenshot%202025-05-03%20at%205.00.25%20PM.png" /></p>
<p>If our stride is &gt;= block length, we do not have an advantage of bringing the entire line in.</p>
<h2 id="matrix-multiply">Matrix Multiply<a class="headerlink" href="#matrix-multiply" title="Permanent link">&para;</a></h2>
<p>Everyone times everyone, and boom, you add up to there!
(Noted with the orange colors). Unfortunately, matrix multiply is a very very very common problem in the real-world (i.e, lots of applications)</p>
<p>When you multiply two matrices together, the end result is the product. 
Multiplying the two rows, gets you this one square in the last matrix (i.e, the product)
<img alt="Screenshot 2025-05-03 at 5.21.32 PM.png" src="../screenshots/Screenshot%202025-05-03%20at%205.21.32%20PM.png" /></p>
<p>Note: Arrays are commonly stored in row-major order.</p>
<p>When we do the standard matrix multiply, we make really bad use of our cache.
<img alt="Screenshot 2025-05-03 at 5.23.00 PM.png" src="../screenshots/Screenshot%202025-05-03%20at%205.23.00%20PM.png" /></p>
<p>The reason that we get a bunch of cache misses within the B matrix, is b/c of the architecture that we are storing our data in. We store things in row-major order. This means that we are essentially always going to be going to main memory when we try to get values for this matrix. (Depending on the arch. matrices can be stored in column major order as well)
When we get to the next column, what we suffer from is something called a cache eviction, so we can't even reuse the things that were stored previously in the cache. We keep having to go to main memory, which is of course not something that we want to do. What we need to do is transpose our matrix to solve this problem of constant cache evictions.</p>
<p>Thus, what this motivates us to do, is to transpose matrix B, and ensure we are utilizing our cache effectively.
<img alt="Screenshot 2025-05-03 at 5.23.37 PM.png" src="../screenshots/Screenshot%202025-05-03%20at%205.23.37%20PM.png" /></p>
<p>When you transpose matrix B, what this ends up doing is reduce your working-set size. The technique of cache blocking comes in b/c instead of working with this large set of data, let's just work with smaller pieces of data to be more effective with how we are storing things in the cache. </p>
<h3 id="cache-blocking">Cache Blocking<a class="headerlink" href="#cache-blocking" title="Permanent link">&para;</a></h3>
<p>A technique where data accesses are rearranged to make
better use of the data that is brought into the cache. Helps prevent repeatedly evicting and fetching the same data from the main memory. </p>
<p>The data access being <code>rearranged</code> in this case would be just accessing those little blocks and such instead of the entire row. </p>
<p>Visual representation:
<img alt="Screenshot 2025-05-04 at 10.34.25 AM.png" src="../screenshots/Screenshot%202025-05-04%20at%2010.34.25%20AM.png" /></p>
<p>As a result, what he have is a really low cache miss rate. We are not getting as many cache misses as we would have without using the cache blocking technique. 
Find other articles on the concept of cache blocking</p>
<p>Although this is sequential, this is freaking critical for sequential performance. If your cache is cooked, then you are not going to ever get good parallel performance. You will always just be waiting on main memory.</p>
<h2 id="loop-un-rolling">Loop Un-rolling<a class="headerlink" href="#loop-un-rolling" title="Permanent link">&para;</a></h2>
<p>Compiler writers spend a huge amount of time spent optimizing loops. This is due to Amdahl's law. The inner loop of the program is where you spend the most amount of your time in. The caveat is that compilers are often optimized around relatively simple loop shapes. So nothing super complicated. (The bounds should be easy to compute and are small in general) Loop unrolling works really well with good caches. </p>
<p><div class="highlight"><pre><span></span><code><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
A loop with small and fixed bounds. 
You gotta make sure that you have the optimizer on! <code>(O2, O3, etc)</code></p>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">max</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">){</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">){</span>
<span class="w">        </span><span class="n">ar</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">src2</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<p>With the optimization flag, what the compiler does is turn the simple loop above, into this:
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">max</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">ar</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">src</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">src2</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<span class="w">    </span><span class="c1">// this is unrolled 4 more times</span>
<span class="w">    </span><span class="n">ar</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">...</span><span class="w"> </span>
<span class="w">    </span><span class="n">ar</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="p">...</span>
<span class="w">    </span><span class="c1">// Continues, all the way to `j + 3`</span>
<span class="p">}</span>
</code></pre></div></p>
<p><em>Gonna have to review concepts regarding loop unrolling</em></p>
<h3 id="chip-multicore-multiprocessor">(Chip) Multicore Multiprocessor<a class="headerlink" href="#chip-multicore-multiprocessor" title="Permanent link">&para;</a></h3>
<p>SMP: (Shared Memory) Symmetric Multiprocessor
- Two or more CPUs/Cores
- Single shared coherent memory
<img alt="Screenshot 2025-05-04 at 11.05.01 AM.png" src="../screenshots/Screenshot%202025-05-04%20at%2011.05.01%20AM.png" /></p>
<p>Single physical address space shared by all of the processors / cores
Processors coordinate / communicate through shared variables in memory (via loads and stores) 
- Use of shared data has to be coordinated via synchronization primitives (i.e, locks) that allow access to data only one processor at a time. Basically all multicore computers today are SMP</p>
<h3 id="multiprocessor-caches">Multiprocessor Caches:<a class="headerlink" href="#multiprocessor-caches" title="Permanent link">&para;</a></h3>
<ul>
<li>Memory will always be a bottle neck, even within a uni-processor system</li>
<li>We use caches to reduce the bandwidth demands to main memory</li>
<li>Each core within a multicore system has their own private cache.</li>
<li>Only cache misses will have to access to the common shared memory</li>
</ul>
<p>The problem amongst multiprocessor caches: Coherency issues</p>
<p>Two CPU's on a bus both read the same data; each processor gets a copy of the data and stored it within their respective cache. Then, one CPU performed a write, their cache is up to date, but the other processor has stale data (it is unaware of its own data being stale) </p>
<p>How can we communicate when one processor changes the state of the shared data? Doers every processor action cause data to change state? Who should be responsible for providing the updated data? What happens to memory while all of this is happening?</p>
<h3 id="what-is-the-goal-of-cache-coherence">What is the goal of cache coherence?<a class="headerlink" href="#what-is-the-goal-of-cache-coherence" title="Permanent link">&para;</a></h3>
<p>Architect's job: shared memory
-&gt; keeping cache values coherent</p>
<p>When any processor has cache miss or writes, notify other processors via the interconnection network. 
- If you are only reading, many processors can have copies
- If a processor writes, invalidate any of the other copies</p>
<p>Write transactions from one processor, other caches "snoop" the common interconnect checking for tags that they hold.
- We invalidate any copies of same address modified in the other cache</p>
<p>Keeping state &amp; MSI: Just like we have the <code>valid</code> and <code>dirty</code> bits for each corresponding cache block, we now introduce a new bit called <code>shared</code>.
Remember, state is kept at a block by block basis. All of the data within a block should hypothetically have the same state. </p>
<h3 id="more-enhancements">More enhancements:<a class="headerlink" href="#more-enhancements" title="Permanent link">&para;</a></h3>
<p>We want to use <strong><em>write-back</em></strong> caches. A <strong><em>write-through</em></strong> cache design uses much more memory bandwidth. We want to minimize the number of writes overall. So "write-back" even in the case of shared cache blocks!!!</p>
<p>We can communicate by broadcasting requests (i.e, shout out to all of the other processors). What is absolutely insane is that even getting some piece of information from a neighboring cache is still much faster / quicker than trying to access something from main memory. Look in your friend's cache! Fuck it. </p>
<p>What is the difference between a <strong>write-back</strong> cache and a <strong>write-through</strong> cache? Write back will just update the cache, and mark the block as dirty. The main memory will later get updated, when that block is replaced or explicitly flushed.
Write-through: Every time that the CPU writes data to the cache,  it will also write the same data to the main memory immediately. </p>
<p>Now, each cache tracks the <strong>state</strong> of each block in the cache:
1. <strong>Shared</strong>: up-to-date data, other caches may have a copy. (Valid bit is set, and the shared bit is set for this block)
2. <strong>Modified:</strong> up-to-date data, changed (dirty), no other cache has a copy, OK to write, memory out-of-date, (Both the valid, and the dirty bit are set)
3. Exclusive: Up-to-date data, no other cache has a copy of it, OK to write, memory is up to date. 
        - If any other of the cache reads this line, the state will become <code>shared</code>
        - If I were to write to this particular line, the state would become modified, but I don't need to tell any of the other caches that!
        - Only valid is set
4. Owner: up-to-date data, other caches may have a copy (they must be in the Shared state), memory is NOT up to date.
    - This cache can supplies data on a read instead of trying to go to the main memory. Saves the need for a write back when someone else reads the line
    - Valid, Dirty, and shared bit is set
    - When you write, you once again, have to have the other caches invalidate</p>
<p>Conceptual Understanding:</p>
<p>What is the name of the private cache that each processor core has?</p>
<p>What is the cache coherence problem?
It is the uniformity of shared resource data that ends up stored in multiple local caches.</p>
<p>The Cache Coherence Problem:</p>
<pre><code>It is the challenge of keeping multiple local caches *synchronized* when one of the processors updates its local copy of data which is shared among multiple caches.
</code></pre>
<p>Terminology that is really important to understand:
<img alt="Screenshot 2025-05-04 at 12.12.13 PM.png" src="../screenshots/Screenshot%202025-05-04%20at%2012.12.13%20PM.png" /></p>
<p>The highlighted line right here is something referred to as a cache line, (i.e, cache block). We keep track of whatever the hell goes on with this particular component within our cache. </p>
<p>Q: What is the difference between a <em>cache line</em> and a <em>cache block</em>?
A: The difference between a cache line and a cache block is the following:</p>
<p><em>Protocols to solve this problem:</em>
Snoopy protocol, this is where we essentially will look at whatever is going on within the interconnect and make sure that coherency is in check.</p>
<p>Each core has a private cache.</p>
<p><img alt="Screenshot 2025-05-04 at 12.56.53 PM.png" src="../screenshots/Screenshot%202025-05-04%20at%2012.56.53%20PM.png" />
Any time that you want to interact with the main memory, you have gotta go through this bus, the other processors are gonna be listening because they have to ensure that they do not need to do anything regarding that particular request. (i.e, An example of this could be a read request, let's say I want to read a value from main memory) </p>
<p>What happens when I try to update the value of a variable that is in a cache block that's currently in the <code>shared</code> state? What is the process of what happens?
- The processor will send a upgrade request to the bus, the bus let's the other processor caches know that the upgrade is happening, and will make that block as invalid due to the fact that there is an inconsistency of what lies in that block amongst the caches now!</p>
<p>The next lecture goes more in depth on this particular cache coherency protocol</p>
<p>A write can be placed on the bus, and the <code>sharers</code> have to invalidate themselves.
<strong><em>Links to external learning material to understand caching at a deeper level:</em></strong>
1. University of Washington – Cache Introduction https://courses.cs.washington.edu/courses/cse378/09wi/lectures/lec15.pdf
2. UC San Diego – The Basics of Caches https://cseweb.ucsd.edu/classes/su07/cse141/cache-handout.pdf
3. GeeksforGeeks – Cache Memory in Computer Organization https://www.geeksforgeeks.org/cache-memory-in-computer-organization/
4. Wikipedia – CPU Cache https://en.wikipedia.org/wiki/CPU_cache
5. Swarthmore College – Cache Architecture and Design https://www.cs.swarthmore.edu/~kwebb/cs31/f18/memhierarchy/caching.html
6. Dive Into Systems – Caching https://diveintosystems.org/book/C11-MemHierarchy/caching.html</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>